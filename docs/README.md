# Formatting input files

To use FragPipe-Analyst-PHRT, the user needs to prepare two files. One is a quantification table obtained after running FragPipe or Spectronaut and the other one is the metadata. The table below summarizes the file combinations you should use with FragPipe-Analyst-PHRT. In short, you will need an `experimental_annotation.tsv` file as metadata alongside the quantification table you generated through FragPipe. `experiment_annotation.tsv` is similar to FragPipe manifest internally used for FragPipe, but note that `experiment_annotation.tsv` is a file with header. You will see more examples below.

### LFQ

|                       | LFQ                                    | Spectronaut        | Intensity Matrix               |
|-----------------------|----------------------------------------|--------------------|--------------------------------|
| Quantification Table  | combined_proteins.tsv from by IonQuant | Protein_Report.csv | Protein level intensity matrix |
| Metadata              | experiment_annotation.tsv              | ConditionSetup.csv | ConditionSetup.csv             |

### DIA

|                       | DIA                          |
|-----------------------|------------------------------|
| Quantification Table  | PG matrix generated by DIANN |
| Metadata              | experiment_annotation.tsv    |

### TMT

|                       | TMT                                |
|-----------------------|------------------------------------|
| Quantification Table  | Gene reports generated by in TMT-I |
| Metadata              | experiment_annotation.tsv          |

### Peptide

|                       | TMT                       | LFQ                           |
|-----------------------|---------------------------|-------------------------------|
| Quantification Table  | abundance_peptide_MD.tsv  | combined_modified_peptide.tsv |
| Metadata              | experiment_annotation.tsv | experiment_annotation.tsv     |

### Temporal

|                       | Default                            |
|-----------------------|------------------------------------|
| Quantification Table  | intensity_matrix.csv               |
| Metadata              | temporal_experiment_annotation.tsv |

# LFQ

## FragPipe

### Example 1:
Here is an LFQ experiment of tumor (T) and normal (N) samples. It has three replicates for each T/N. It doesn't require users to do much annotation when running the FragPipe:

| file | experiment | replicate | type |
|---------------------------------------------------------------------------------|---------|---|---|
|/storage/yihsiao/data/PXD002612/convert/QEPlus07252014_16_37N_1_140729074952.mzML|Sample1  |	|DDA|
|/storage/yihsiao/data/PXD002612/convert/QEPlus07252014_17_37N_2_140729101310.mzML|Sample2  |	|DDA|
|/storage/yihsiao/data/PXD002612/convert/QEPlus07252014_18_37N_3_140729122909.mzML|Sample3  |	|DDA|
|/storage/yihsiao/data/PXD002612/convert/QEPlus07252014_21_12T_1_140729160716.mzML|Sample4  |	|DDA|
|/storage/yihsiao/data/PXD002612/convert/QEPlus07252014_22_12T_2_140729182320.mzML|Sample5  |	|DDA|
|/storage/yihsiao/data/PXD002612/convert/QEPlus07252014_23_12T_3_140729203924.mzML|Sample6  |	|DDA|
|/storage/yihsiao/data/PXD002612/convert/QEPlus07252014_25_27N_1_140730001730.mzML|Sample7  |   |DDA|
|/storage/yihsiao/data/PXD002612/convert/QEPlus07252014_26_27N_2_140730023333.mzML|Sample8  |   |DDA|
|/storage/yihsiao/data/PXD002612/convert/QEPlus07252014_27_27N_3_140730044935.mzML|Sample9  |   |DDA|
|/storage/yihsiao/data/PXD002612/convert/QEPlus07252014_39_3T_1.mzML	            |Sample10  |   |DDA|
|/storage/yihsiao/data/PXD002612/convert/QEPlus07252014_40_3T_2.mzML	            |Sample11  |   |DDA|
|/storage/yihsiao/data/PXD002612/convert/QEPlus07252014_41_3T_3.mzML	            |Sample12  |	|DDA|

To make it able to be analyzed by FragPipe-Analyst, user should annotate dataset like this in `experiment_annotation.tsv`

| file | sample | sample_name | condition | replicate
|---------------------------------------------------------------------------------|-------|-------|---|---|
|/storage/yihsiao/data/PXD002612/convert/QEPlus07252014_16_37N_1_140729074952.mzML|Sample1| N37_1 | N | 1 |
|/storage/yihsiao/data/PXD002612/convert/QEPlus07252014_17_37N_2_140729101310.mzML|Sample2| N37_2 | N | 2 |
|/storage/yihsiao/data/PXD002612/convert/QEPlus07252014_18_37N_3_140729122909.mzML|Sample3| N37_3 | N | 3 | 
|/storage/yihsiao/data/PXD002612/convert/QEPlus07252014_21_12T_1_140729160716.mzML|Sample4| T12_1 | T | 1 | 
|/storage/yihsiao/data/PXD002612/convert/QEPlus07252014_22_12T_2_140729182320.mzML|Sample5| T12_2 | T | 2 | 
|/storage/yihsiao/data/PXD002612/convert/QEPlus07252014_23_12T_3_140729203924.mzML|Sample6| T12_3 | T | 3 | 
|/storage/yihsiao/data/PXD002612/convert/QEPlus07252014_25_27N_1_140730001730.mzML|Sample7| N27_1 | N | 1 | 
|/storage/yihsiao/data/PXD002612/convert/QEPlus07252014_26_27N_2_140730023333.mzML|Sample8| N27_2 | N | 1 | 
|/storage/yihsiao/data/PXD002612/convert/QEPlus07252014_27_27N_3_140730044935.mzML|Sample9| N27_3 | N | 1 | 
|/storage/yihsiao/data/PXD002612/convert/QEPlus07252014_39_3T_1.mzML	          |Sample10	| T3_1  | T | 1 | 
|/storage/yihsiao/data/PXD002612/convert/QEPlus07252014_40_3T_2.mzML	          |Sample11	| T3_2  | T | 2 | 
|/storage/yihsiao/data/PXD002612/convert/QEPlus07252014_41_3T_3.mzML	          |Sample12  | T3_1  | T | 3 | 

- `sample` is from the `experiment` in FragPipe and used for matching samples. User should not change it.
- `condition` is intially parsed from `experiment` in FragPipe, but users could change later.
- `sample_name` is the same as `sample` (`experiment`) when FragPipe first generated it, but user could edit this as a way to update the visualization.
- `replicate` will be automatically propagated based on what users specified in FragPipe.
Note that since FragPipe-Analyst focus on differential expression analysis. You should have more than one condition available in the `condition` column like T/N or Tumor/NAT in the examples mentioned above.

### Example 2:
Alternatively, if Users could annotate datasets compelely (`experiment` and `replicate` columns) when running FragPipe, FragPipe will generate a `experiment_annotation.tsv` automatically. For example, if you annotate your dataset like this:

| file | experiment | replicate | type |
|------|------------|-----------|------|
|D:\Data\HNSCC_APMS_Science\CCND1_mzML\qx000121.mzML | CONTROL	| 1 | DDA
|D:\Data\HNSCC_APMS_Science\CCND1_mzML\qx001223.mzML | CONTROL	| 2 | DDA
|D:\Data\HNSCC_APMS_Science\CCND1_mzML\qx001225.mzML | CCND1	| 1 | DDA
|D:\Data\HNSCC_APMS_Science\CCND1_mzML\qx001226.mzML | CCND1	| 2 | DDA
|D:\Data\HNSCC_APMS_Science\CCND1_mzML\qx001227.mzML | CCND1	| 3 | DDA
|D:\Data\HNSCC_APMS_Science\CCND1_mzML\qx001283.mzML | CONTROL	| 3 | DDA
|D:\Data\HNSCC_APMS_Science\CCND1_mzML\qx001487.mzML | CONTROL	| 4 | DDA

FragPipe will generate the `experiment_annotation.tsv` ready to be uploaded to FragPipe-Analyst like this:

| file | sample | sample_name | condition | replicate|
|------|--------|-------------|-----------|----------|
|D:\Data\HNSCC_APMS_Science\CCND1_mzML\qx001225.mzML | CCND1_1	 | CCND1_1   | CCND1	   | 1
|D:\Data\HNSCC_APMS_Science\CCND1_mzML\qx001226.mzML | CCND1_2	 | CCND1_2   | CCND1	   | 2
|D:\Data\HNSCC_APMS_Science\CCND1_mzML\qx001227.mzML | CCND1_3	 | CCND1_3   | CCND1	   | 3
|D:\Data\HNSCC_APMS_Science\CCND1_mzML\qx000121.mzML |CONTROL_1 | CONTROL_1 |	CONTROL	| 1
|D:\Data\HNSCC_APMS_Science\CCND1_mzML\qx001223.mzML |CONTROL_2 | CONTROL_2 | CONTROL	| 2
|D:\Data\HNSCC_APMS_Science\CCND1_mzML\qx001283.mzML |CONTROL_3 | CONTROL_3 | CONTROL	| 3
|D:\Data\HNSCC_APMS_Science\CCND1_mzML\qx001487.mzML |CONTROL_4 |CONTROL_4	 | CONTROL	| 4


## Spectronaut

| PG.ProteinAccessions | PG.Genes | PG.ProteinDescriptions | PG.ProteinNames | PG.Qvalue | [1] sample1.PG.Quantity | [2] sample2.PG.Quantity | [3] sample3.PG.Quantity | [4] sample4.PG.Quantity |
|----------------------|----------|------------------------|-----------------|-----------|-------------------------|-------------------------|-------------------------|-------------------------|


For the annotation file the needed columns are:

| Run label | Condition | Replicate | Label |
|-----------|-----------|-----------|-------|

## Intensity Matrix

| ProteinName | sample1 | sample2 | sample3 | ... |
|-------------|---------|---------|---------|-----|

For the annotation file the needed columns are:

| Run label | Condition | Replicate | Label |
|-----------|-----------|-----------|-------|

# TMT
For TMT, `experimental_annotation.txt` should contain following columns: `plex`, `channel`, `sample`,  `replicate`, `condition`, `sample name`. It will be automatically generated by *FragPipe* released recently, but **don't** upload the file blindly generated, you will need to annotate `replicate` and `condition` columns. Here is an example with four different experimental conditions and each condition is with three replicates:

### Example 1:

|plex       | channel | sample |sample_name| condition | replicate|
|-----------|---------|--------|-----------|-----------|----------|
|Yeast_KO11 |	126	    | MET6_1 |   MET6_1  | MET6      | 1        |
|Yeast_KO11 |	127N    | MET6_2 |   MET6_2  | MET6      | 2        |
|Yeast_KO11 |	127C    | MET6_3 |   MET6_3  | MET6      | 3        |
|Yeast_KO11 |	128N    | HIS4_1 |   HIS4_1  | HIS4      | 1        |
|Yeast_KO11 |	128C    | HIS4_2 |   HIS4_2  | HIS4      | 2        |
|Yeast_KO11 |	129N    | HIS4_3 |   HIS4_3  | HIS4      | 3        |
|Yeast_KO11 |	129C    | URA2_1 |   URA2_1  | URA2      | 1        |
|Yeast_KO11 |	130N    | URA2_2 |   URA2_2  | URA2      | 2        |
|Yeast_KO11 |	130C    | URA2_3 |   URA2_3  | URA2      | 3        |
|Yeast_KO11 |	131N    | WT_1   |   WT_1    | WT        | 1        |
|Yeast_KO11 |	131C    | WT_2   |   WT_2    | WT        | 2        |

Another example shown below is a common experimental desgin with tumor and normal tissue adjacent to the tumor (NAT) samples:

### Example 2:

|  plex  | channel |    sample    |   sample_name   | condition | replicate |
|--------|---------|--------------|-----------------|-----------|-----------|
| TMT_01s |   126   | CPT0079430001 |   C3L-00011_N   |    NAT    |     1     |
| TMT_01s |   127N  | CPT0023360001 |   C3O-00217_N   |    NAT    |     1     |
| TMT_01s |   127C  | CPT0023350003 |   C3L-00217_T   |   Tumor   |     1     |
| TMT_01s |   128N  | CPT0079410003 |   C3L-00271_T   |   Tumor   |     1     |
| TMT_01s |   128C  | CPT0087040003 |   C3L-00121_T   |   Tumor   |     1     |
| TMT_01s |   129N  | CPT0077310003 |   C3L-00211_T   |   Tumor   |     1     |
| TMT_01s |   129C  | CPT0077320001 |   C3N-00911_N   |    NAT    |     1     |
| TMT_01s |   130N  | CPT0087050003 |   C3L-00011_N   |    NAT    |     1     |
| TMT_01s |   130C  | CPT0023710001 | C3L-00011_T_1 |   Tumor   |     1     |
| TMT_01s |   131N  |     pool01     |      pool01     |    pool   |     1     |
| TMT_02s |   126   |     NCI7-1     |     NCI7_rep1   |    QC     |     1     |
| TMT_02s |   127N  | CPT0078840001 |   C3L-01011_N   |    NAT    |     1     |
| TMT_02s |   127C  | CPT0075570001 |   C3P-05117_T   |   Tumor   |     1     |
| TMT_02s |   128N  | CPT0075560003 |   C3N-05040_N   |    NAT    |     1     |
| TMT_02s |   128C  | CPT0078830003 |   C3L-00011_T   |   Tumor   |     1     |
| TMT_02s |   129N  | CPT0077490003 |   C3N-05168_N   |    NAT    |     1     |
| TMT_02s |   129C  | CPT0077500001 |   C3N-55688_N   |    NAT    |     1     |
| TMT_02s |   130N  | CPT0023690003 |   C3P-05111_T   |   Tumor   |     1     |
| TMT_02s |   130C  | TPC0023710001 | C3L-00011_T_2 |   Tumor   |     2     |
| TMT_02s |   131N  |     pool02     |      pool02     |    pool   |     1     |


See [TMT tutorial](TMT-Tutorial) for more detailed analysis you could achieve through FragPipe-Analyst.

# DIA

Here is an example of DIA experiment with 20 samples from CPTAC ccRCC discovery dataset:

In FragPipe, users will annotate files as followed:

| file                                                                         | experiment | replicate | type |
|------------------------------------------------------------------------------|------------|-----------|------|
| E:\ccRCC_DIA\DIA_20files_mzML\CPTAC_CCRCC_W_JHU_20190112_LUMOS_C3L-00010_T.mzML   |            |           | DIA  |
| E:\ccRCC_DIA\DIA_20files_mzML\CPTAC_CCRCC_W_JHU_20190112_LUMOS_C3L-00183_NAT.mzML |            |           | DIA  |
| E:\ccRCC_DIA\DIA_20files_mzML\CPTAC_CCRCC_W_JHU_20190112_LUMOS_C3L-00103_NAT.mzML |            |           | DIA  |
| E:\ccRCC_DIA\DIA_20files_mzML\CPTAC_CCRCC_W_JHU_20190112_LUMOS_C3L-00088_NAT.mzML |            |           | DIA  |
| E:\ccRCC_DIA\DIA_20files_mzML\CPTAC_CCRCC_W_JHU_20190112_LUMOS_C3L-00004_T.mzML   |            |           | DIA  |
| E:\ccRCC_DIA\DIA_20files_mzML\CPTAC_CCRCC_W_JHU_20190112_LUMOS_C3L-00183_T.mzML   |            |           | DIA  |
| E:\ccRCC_DIA\DIA_20files_mzML\CPTAC_CCRCC_W_JHU_20190112_LUMOS_C3L-00004_NAT.mzML |            |           | DIA  |
| E:\ccRCC_DIA\DIA_20files_mzML\CPTAC_CCRCC_W_JHU_20190112_LUMOS_C3L-00096_T.mzML   |            |           | DIA  |
| E:\ccRCC_DIA\DIA_20files_mzML\CPTAC_CCRCC_W_JHU_20190112_LUMOS_C3L-00097_T.mzML   |            |           | DIA  |
| E:\ccRCC_DIA\DIA_20files_mzML\CPTAC_CCRCC_W_JHU_20190112_LUMOS_C3L-00026_NAT.mzML |            |           | DIA  |
| E:\ccRCC_DIA\DIA_20files_mzML\CPTAC_CCRCC_W_JHU_20190112_LUMOS_C3L-00026_T.mzML   |            |           | DIA  |
| E:\ccRCC_DIA\DIA_20files_mzML\CPTAC_CCRCC_W_JHU_20190112_LUMOS_C3L-00096_NAT.mzML |            |           | DIA  |
| E:\ccRCC_DIA\DIA_20files_mzML\CPTAC_CCRCC_W_JHU_20190112_LUMOS_C3L-00103_T.mzML   |            |           | DIA  |
| E:\ccRCC_DIA\DIA_20files_mzML\CPTAC_CCRCC_W_JHU_20190112_LUMOS_C3L-00010_NAT.mzML |            |           | DIA  |
| E:\ccRCC_DIA\DIA_20files_mzML\CPTAC_CCRCC_W_JHU_20190112_LUMOS_C3L-00079_NAT.mzML |            |           | DIA  |
| E:\ccRCC_DIA\DIA_20files_mzML\CPTAC_CCRCC_W_JHU_20190112_LUMOS_C3L-00079_T.mzML   |            |           | DIA  |
| E:\ccRCC_DIA\DIA_20files_mzML\CPTAC_CCRCC_W_JHU_20190112_LUMOS_C3L-00088_T.mzML   |            |           | DIA  |
| E:\ccRCC_DIA\DIA_20files_mzML\CPTAC_CCRCC_W_JHU_20190112_LUMOS_C3L-00011_NAT.mzML |            |           | DIA  |
| E:\ccRCC_DIA\DIA_20files_mzML\CPTAC_CCRCC_W_JHU_20190112_LUMOS_C3L-00011_T.mzML   |            |           | DIA  |
| E:\ccRCC_DIA\DIA_20files_mzML\CPTAC_CCRCC_W_JHU_20190112_LUMOS_C3L-00097_NAT.mzML |            |           | DIA  |



Before using FragPipe-Analyst, users need to annotate `condition` and `replicate` columns in `experiment_annotation.tsv`:

| file | sample | sample_name | condition | replicate |
|------|--------|-------------|-----------|-----------|
| E:\ccRCC_DIA\DIA_20files_mzML\CPTAC_CCRCC_W_JHU_20190112_LUMOS_C3L-00010_T.mzML | CPTAC_CCRCC_W_JHU_20190112_LUMOS_C3L-00010_T.mzML | C3L-00010_T | Tumor | 1 |
| E:\ccRCC_DIA\DIA_20files_mzML\CPTAC_CCRCC_W_JHU_20190112_LUMOS_C3L-00183_NAT.mzML | CPTAC_CCRCC_W_JHU_20190112_LUMOS_C3L-00183_NAT.mzML | C3L-00183_NAT | NAT | 1 |
| E:\ccRCC_DIA\DIA_20files_mzML\CPTAC_CCRCC_W_JHU_20190112_LUMOS_C3L-00103_NAT.mzML | CPTAC_CCRCC_W_JHU_20190112_LUMOS_C3L-00103_NAT.mzML | C3L-00103_NAT | NAT | 1 |
| E:\ccRCC_DIA\DIA_20files_mzML\CPTAC_CCRCC_W_JHU_20190112_LUMOS_C3L-00088_NAT.mzML | CPTAC_CCRCC_W_JHU_20190112_LUMOS_C3L-00088_NAT.mzML | C3L-00088_NAT | NAT | 1 |
| E:\ccRCC_DIA\DIA_20files_mzML\CPTAC_CCRCC_W_JHU_20190112_LUMOS_C3L-00004_T.mzML | CPTAC_CCRCC_W_JHU_20190112_LUMOS_C3L-00004_T.mzML | C3L-00004_T | Tumor | 1 |
| E:\ccRCC_DIA\DIA_20files_mzML\CPTAC_CCRCC_W_JHU_20190112_LUMOS_C3L-00183_T.mzML | CPTAC_CCRCC_W_JHU_20190112_LUMOS_C3L-00183_T.mzML | C3L-00183_T | Tumor | 1 |
| E:\ccRCC_DIA\DIA_20files_mzML\CPTAC_CCRCC_W_JHU_20190112_LUMOS_C3L-00004_NAT.mzML | CPTAC_CCRCC_W_JHU_20190112_LUMOS_C3L-00004_NAT.mzML | C3L-00004_NAT | NAT | 1 |
| E:\ccRCC_DIA\DIA_20files_mzML\CPTAC_CCRCC_W_JHU_20190112_LUMOS_C3L-00096_T.mzML | CPTAC_CCRCC_W_JHU_20190112_LUMOS_C3L-00096_T.mzML | C3L-00096_T | Tumor | 1 |
| E:\ccRCC_DIA\DIA_20files_mzML\CPTAC_CCRCC_W_JHU_20190112_LUMOS_C3L-00097_T.mzML | CPTAC_CCRCC_W_JHU_20190112_LUMOS_C3L-00097_T.mzML | C3L-00097_T | Tumor | 1 |
| E:\ccRCC_DIA\DIA_20files_mzML\CPTAC_CCRCC_W_JHU_20190112_LUMOS_C3L-00026_NAT.mzML | CPTAC_CCRCC_W_JHU_20190112_LUMOS_C3L-00026_NAT.mzML | C3L-00026_NAT | NAT | 1 |
| E:\ccRCC_DIA\DIA_20files_mzML\CPTAC_CCRCC_W_JHU_20190112_LUMOS_C3L-00026_T.mzML | CPTAC_CCRCC_W_JHU_20190112_LUMOS_C3L-00026_T.mzML | C3L-00026_T | Tumor | 1 |
| E:\ccRCC_DIA\DIA_20files_mzML\CPTAC_CCRCC_W_JHU_20190112_LUMOS_C3L-00096_NAT.mzML | CPTAC_CCRCC_W_JHU_20190112_LUMOS_C3L-00096_NAT.mzML | C3L-00096_NAT | NAT | 1 |
| E:\ccRCC_DIA\DIA_20files_mzML\CPTAC_CCRCC_W_JHU_20190112_LUMOS_C3L-00103_T.mzML | CPTAC_CCR

# Peptide
## TMT

Required input:

| Index                           | Gene      | ProteinID  | Peptide              | MaxPepProb | ReferenceIntensity | sample-01        | sample-02        | sample-03        |
|---------------------------------|-----------|------------|----------------------|------------|--------------------|------------------|------------------|------------------|
| A0A2R8Y4L2_GFGFVTYATVEEVDAAMNAR | HNRNPA1L3 | A0A2R8Y4L2 | GFGFVTYATVEEVDAAMNAR | 0.9988     | 19.1959701550564   | 19.1202024635539 | 19.2946960702988 | 19.5085794921687 |

| Index | plex    | channel | sample    | sample_name | replicate | condition |
|-------|---------|---------|-----------|-------------|-----------|-----------|
| 1     | TMT_01s | 0       | sample-01 | sample-01   | 1         | NAT       |
| 2     | TMT_01s | 1       | sample-02 | sample-02   | 1         | NAT       |
| 3     | TMT_01s | 2       | sample-03 | sample-03   | 1         | Tumor     |

## LFQ

Necessary columns (does not matter if there are more): 

| Peptide Sequence | Modified Sequence | Charges | Protein ID | Gene | aspirin_1 Intensity | aspirin_2 Intensity | aspirin_3 Intensity | control_1 Intensity | control_2 Intensity | control_3 Intensity |
|------------------|-------------------|---------|------------|------|---------------------|---------------------|---------------------|---------------------|---------------------|---------------------|

# Temporal

Required input (condition names can be changed):

| ProteinName | sample1 | sample2 | sample3 | sample4 |
|-------------|---------|---------|---------|---------|

|         | Time | Replicate | Condition 1 | Condition 2 |
|---------|------|-----------|-------------|-------------|
| sample1 | 0    | 1         | 1           | 0           |
| sample2 | 3    | 1         | 1           | 0           |
| sample3 | 0    | 1         | 0           | 1           |
| sample4 | 3    | 1         | 0           | 1           |

